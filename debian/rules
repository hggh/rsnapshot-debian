#!/usr/bin/make -f
# -*- makefile -*-

override_dh_auto_clean:
	[ ! -f Makefile ] || $(MAKE) clean
	# restore upstream files
	[ ! -f rsnapshot.1.bak ]      || cp -f rsnapshot.1.bak      rsnapshot.1
	[ ! -f rsnapshot-diff.1.bak ] || cp -f rsnapshot-diff.1.bak rsnapshot-diff.1

override_dh_auto_configure:
	# backup upstream automatically generated files
	cp -f rsnapshot.1      rsnapshot.1.bak
	cp -f rsnapshot-diff.1 rsnapshot-diff.1.bak
	dh_auto_configure

override_dh_install:
	dh_install
	# rename default configfile
	mv $(CURDIR)/debian/rsnapshot/etc/rsnapshot.conf.default $(CURDIR)/debian/rsnapshot/etc/rsnapshot.conf
	# lintian override on /var/cache/rsnapshot perms
	mkdir -p $(CURDIR)/debian/rsnapshot/usr/share/lintian/overrides/
	cp $(CURDIR)/debian/lintian-overrides $(CURDIR)/debian/rsnapshot/usr/share/lintian/overrides/rsnapshot
	# html doc, see debian/doc-base
	cp $(CURDIR)/docs/HOWTOs/rsnapshot-HOWTO.en.html $(CURDIR)/debian/rsnapshot/usr/share/doc/rsnapshot/html/

override_dh_installexamples:
	dh_installexamples
	# Remove unnecessary extra license file, as per Policy Manual section 12.5
	rm $(CURDIR)/debian/rsnapshot/usr/share/doc/rsnapshot/examples/utils/rsnapshotdb/LICENSE.txt

override_dh_fixperms:
	dh_fixperms
	# Fix permissions of the default rsnapshot_root directory
	chmod 0700 $(CURDIR)/debian/rsnapshot/var/cache/rsnapshot

%:
	dh $@ --with autotools-dev
